<!DOCTYPE html>
<html>
<body>
<script>

    document.write(myFunction("abcd", "def"))

    function myFunction(s, key) {

        var input = s.concat(key);
        var listK = new Array(key.length);
        var listKCodeAt = new Array(key.length)

        var listIn = new Array(input.length);
        var listInCodeAt = new Array(input.length)

        var listShifted = new Array(input.length);

        var listNew = new Array(input.length)
        var listNewCodeAt = new Array(input.length)
        var newString = "";
        var b = 0;

        while (b < 1) {

            for (var j = 0; j < key.length; j++) {
                listK[j] = key.charAt(j);
                listKCodeAt[j] = key.charCodeAt(j);
            }

            for (var i = 0; i < input.length; i++) {
                listIn[i] = input.charAt(i);
                listInCodeAt[i] = input.charCodeAt(i)
            }

            //step 4
            for (var p = 0; p < 1; p++) {
                if (newString != '') {
                    input = newString;
                }

                // //Step 2
                for (var m = 0; m < input.length; m++) {
                    listShifted[(m + key.length - 1) % input.length] = listInCodeAt[m]
                }


                //step 3
                for (var k = 0; k < input.length; k++) {
                    listNewCodeAt[k] = listShifted[k] + listKCodeAt[k % key.length];
                    listNew[k] = String.fromCharCode(listNewCodeAt[k]);
                }


                newString = "";
                for (var i = 0; i < input.length; i++) {
                    newString = newString.concat(listNew[i]);
                }
            }
            b++;
        }

        return newString;
    }
</script>

</body>
</html>